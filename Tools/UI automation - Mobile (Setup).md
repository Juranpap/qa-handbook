> *Automation does not do what testers used to do, unless one ignores most things a tester really does. Automated testing is useful for extending the reach of the testers work, not to replace it.*

### Installing Appium - General setup

1. Install Homebrew, XCode, NPM, Node.js
2. Install Appium: `npm install -g appium`
3. Install Appium Doctor: `npm install -g appium-doctor`
4. Check and install dependencies for iOS: `appium-doctor --ios`
5. Check and install dependencies for Android: `appium-doctor --android`
6. Install the [Appium app for Mac](https://bitbucket.org/appium/appium.app/downloads/appium.dmg)

See the [docs](https://appium.io/slate/en/master/) for more details.

### Installing Appium - iOS setup

Unlike Android, the iOS ecosystem is a bit more cocooned. That means that the setup will have to have a few additional steps when compared to the Android setup.

It is possible to setup the iOS configuration in two ways:

* Automatically

	* By running the iOS test, the application under test (or so called WebDriverAgentDriver) is signed automatically. This is possible to achieve by setting the correct signing certificate and provisioning profile to a "dummy project" and turning on the "Sign automatically" feature. More on that bellow.
* Manually

	* More often than not, life doesn't turn out the way we want it to. Translated, Automatic configuration could be fragile due to many different reasons. If that's how your beans fell, I'll get your back covered by writing the Manual configuration too.


#### Where to find the app's [bundle ID](https://developer.apple.com/documentation/appstoreconnectapi/bundle_ids)

1. Go to Tryoutapps and download the .ipa file
2. Change the extension of the .ipa file to .zip
3. Unzip the file and open the "Payload" folder
4. You'll see one file, right click it and choose the "Show package contents" option
5. Open the .plist file and find the "Bundle indentifier" there


#### Desired capabilities explained
        desired_caps = {
            "platformName": "iOS",
            "platformVersion": platform_version,
            "udid": device_name,
            "app": app_path,
            "deviceName": "iPhone",
            "xcodeOrgId": "5F5M64F878",
            "xcodeSigningId": "iPhone Developer",
            "automationName": "XCUITest",
            "useNewWDA": False,
            "autoAcceptAlerts": True,
            "noReset": True
        }

| Desired Capability   | Purpose  | Example |
|---|---|---|
| platformName  | Which mobile platform to use  |"android" or "iOS"|
| platformVersion  | Mobile OS version  | Just the major version, e.g. "13"|
| udid  | Unique device identifier of the connected physical device (just for iOS)  |"123"|
| app  | The absolute local path or remote http URL to an .ipa file (iOS) or .apk file (Android)  ||
| deviceName  | The kind of mobile device you're using  |Actual device ID on Android, "iPhone" on iOS|
| xcodeOrgId | A unique 10-character string generated by Apple that is assigned to your team. |"5F5M64F878" is Infinum D.O.O. ID.|
| xcodeSigningId | This capability is required if you want to test on real device. There's no need to change it's value.|"iPhone Developer"|
| automationName | Which automation engine to use |"XCUITest" or "UIAutomator"|
| useNewWDA | If true, forces uninstall of any existing WebDriverAgent app on device. Set it to true if you want to apply different startup options for WebDriverAgent for each session. Although, it is only guaranteed to work stable on Simulator. Real devices require WebDriverAgent client to run for as long as possible without reinstall/restart to avoid issues.|"False"|
| autoAcceptAlerts | Accept all iOS (only!) alerts automatically if they pop up. This includes privacy access permission alerts (e.g., location, contacts, photos). Default is false.|"True"|
| noReset | Don't reset app state before this session. See [here](http://appium.io/docs/en/writing-running-appium/other/reset-strategies/index.html) for more details. |"True"|

#### Automatic configuration


1. Download XCode and open it
2. Click **"Create a new Xcode project"**
3. Choose the Application template, e.g. **"Single View App"** and click **"Next"**
4. Enter Product name, e.g. **"Demo application"**
5. Click "Add account" and use *infinum1@icloud.com* account
6. Click the **"Team"** dropdown again and Choose **"Infinum D.O.O."**
7. Make sure the "Automatically manage signing" option is checked
8. Enter Organization Identifier, e.g. **"com.infinum.demo-application"** 
9. Click **"Next"**
10. Choose the Project location and click **"Done"**
11. Close the XCode project
12. Open terminal and run `brew install libimobiledevice --HEAD`. In case there's a **"Permission denied"** error, check the step 6. from the Manual configuration setup.
13. Connect your physical iPhone to your Mac and make sure it's trusted device
14. Enter `idevice_id --list` in the terminal and hit enter
15. Copy the ID and use it as a **"UDID/device name"**
16. Start the Appium Server
17. Open PyCharm and your Appium project
18. Ensure there's an .ipa file in the project's Builds folder
19. Type `python3 runner.py --platform=ios --platform-version=11 --device-name=c2d0bbe0f36962e9a508fe1d6a0399383f4c6fd5 --env test --report
` in the PyCharm console

There's a huge chance that some error will pop up, most probably `"No profiles for 'com.facebook.WebDriverAgentRunner.xctrunner were found: Xcode couldn't find any iOS app Development provisioning profiles matching com.facebook.WebDriverAgentRunner.xctrunner'."`. If that's the case, follow this procedure:

1. Inspect the Appium server logs and find the WebDriverAgent path the XCUITest driver is using, most probably `/usr/local/lib/node_modules/appium/node_modules/appium-xcuitest-driver/node_modules/appium-webdriveragent/` and open the `WebDriverAgent.xcodeproj` inside that foder (using Xcode, obviously :) ).
2. Click the WebDriverAgent from the Project navigator
3. Open **"Signing & Capabilities"** tab
4. Choose WebDriverAgentLib from the **"Targets"** section
5. Choose **"Infinum D.O.O."** team manually and wait for signing process to finish
6. Next, choose WebDriverAgentRunner form the **"Targets"** section
7. Again, choose **"Infinum D.O.O."** team manually and wait for signing process to finish
8. The signing will probably fail due to the wrong Bundle identifier. Don't worry, we'll change that.
9. Click the **"Build Settings"** tab
10. Find the **"Packaging"** category and double click the **"Product Bundle Identifier"**. After that, change the value to **"com.infinum.WebDriverAgentRunner"** and try to sign it again
11. Save the project and try to run the Appium project again (step 19.)

	
#### Manual configuration

1. [Download]("http://appium.io/") the Appium client (by pressing the *“Download Appium”* button)
2. Move the application to the *Application folder* 
3. Install [Homebrew](https://brew.sh/)
4. Install [Node.js](https://nodejs.org/en/)
5. Using terminal, run `npm install -g appium`
	* The error *Permission denied* could potentially appear. In that case, run `sudo chmod 777 /usr/local/lib/node_modules` and type your password. Enter `npm install -g appium` again.

6. Run `brew install libimobiledevice --HEAD` 
	* The error *Permission denied* could potentially appear. In that case, run 
	
	- sudo chmod 777 /usr/local/share/doc
	- sudo chmod 777 /usr/local/share/man
	- sudo chmod 777 /usr/local/share/man/man1
	- brew install libimobiledevice --HEAD

7. Run `brew install carthage`
8. Install the latest Xcode build to continue with the setup
	* The important step is to open Xcode application and accept the Agreement, download the latest updates and open it for the first time
9. Run `npm install -g ios-deploy --unsafe-perm=true`
	* You’ll probably see some *xcodebuild requires Xcode* error. If that’s the case, run `sudo xcode-select --switch /Library/Developer/CommandLineTools`
After entering the password, try to run the `npm install -g ios-deploy --unsafe-perm=true` command again. If the issue is still there, you have a bad luck. :) Kidding, here's a solution:
`rm -rf ~/Library/Developer/Xcode/DerivedData/* `
`npm -g uninstall ios-deploy`
`npm -g install ios-deploy@beta`

---

![dil-director.gif](/img/dil-director.gif)

